<html>

<head>
<title>WebGL field</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script type="text/javascript" src="glMatrix-0.9.5.min.js"></script>
<script type="text/javascript" src="webgl-utils.js"></script>

<script id="shader-fs" type="x-shader/x-fragment">
    #ifdef GL_ES
    precision highp float;
    #endif

    varying vec3 vTransformedNormal;
    varying vec4 vPosition;

    uniform vec3 uPointLightingLocation;
    uniform vec3 uPointLightingColor;

    varying vec4 vColor;
    varying vec3 vADLightWeighting;

    void main(void) {
        vec3 lightDirection = normalize(uPointLightingLocation - vPosition.xyz);

        float pointLightWeighting = max(dot(normalize(vTransformedNormal), lightDirection), 0.0);
        vec3 lightWeighting = vADLightWeighting + uPointLightingColor * pointLightWeighting / 3.0;
        
        gl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);
        //gl_FragColor = vColor;
    }
</script>

<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec3 aVertexNormal;
    attribute vec4 aVertexColor;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    uniform mat3 uNMatrix;

    uniform vec3 uAmbientColor;
    uniform vec3 uLightingDirection;
    uniform vec3 uDirectionalColor;

    uniform vec3 uPointLightingLocation;
    uniform vec3 uPointLightingColor;

    varying vec3 vADLightWeighting;
    varying vec4 vPosition;
    varying vec3 vTransformedNormal;

    varying vec4 vColor;

    void main(void) {
        vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);
        gl_Position = uPMatrix * vPosition;
        vColor = aVertexColor;

        vTransformedNormal = uNMatrix * aVertexNormal;
        float directionalLightWeighting = max(dot(vTransformedNormal, uLightingDirection), 0.0);
        
        vADLightWeighting = uAmbientColor + uDirectionalColor * directionalLightWeighting;
    }
</script>


<script type="text/javascript" src="util.js"></script>
<script type="text/javascript" src="js.js"></script>


</head>


<body onload="webGLStart();">
    <canvas id="lesson01-canvas" style="border: none;" width="800" height="500"></canvas>
    <br/>
    <span id="xpos"></span> <span id="ypos"></span> <span id="zpos"></span> <br/>
    <span id="yaw"></span> <span id="pitch"></span>
</body>

</html>
